%% Setup
clear 
clc

%% HP_Filtered Death Rate of Selected Respiratory Diseases 1898 - 1973
HP_RespDthrt=[-314.913000000000;-24.3892100000000;554.520600000000;-179.895200000000;392.928500000000;-290.660000000000;71.8188800000000;-215.649400000000;-299.570700000000;46.0533600000000;106.152200000000;677.286800000000;-412.966200000000;-124.396000000000;141.282600000000;-123.741600000000;-287.885300000000;649.233600000000;-694.940900000000;-976.842700000000;1240.28500000000;1020.49500000000;-431.607900000000;-879.696300000000;899.614100000000;-887.541300000000;545.035000000000;-205.453200000000;-42.0074000000000;-320.756900000000;-310.109600000000;1246.84800000000;-249.354700000000;-442.681300000000;387.799600000000;-305.151300000000;-112.821100000000;52.3274300000000;33.8826400000000;382.060700000000;-386.343700000000;-419.665200000000;728.576200000000;14.0071700000000;-252.318000000000;110.414000000000;-55.6128600000000;-183.880600000000;143.026700000000;113.945900000000;-284.170600000000;-66.6014300000000;94.8418600000000;230.004000000000;114.555000000000;-94.6356600000000;-201.027500000000;34.0619400000000;-22.5208000000000;-46.3788700000000;49.4878200000000;242.500000000000;-221.839600000000;55.1715900000000;-97.2693400000000;259.207200000000;-168.466300000000;-14.8300800000000;171.529800000000;-316.599700000000;73.1236000000000;79.6977900000000;158.421200000000;-268.159500000000;113.155000000000];

%% Calculate 10-Year Moving Average 
MA = movstd(HP_RespDthrt, [10 0]);

%% Run 1000 Iterations of the MA taking draws from the post-1940 Distribution

for i =1:1000
    Y=randsample(HP_RespDthrt(44:end),21,true);
    Z=[HP_RespDthrt(1:22);Y;HP_RespDthrt(44:end)];
    MC(:,i) = movstd(Z, [10 0]);
end

%% Average over the Simulations
Counterfactual = mean(MC,2);
